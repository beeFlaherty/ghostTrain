<h2>Virtual experience</h2>

<div id="virtual_experience">
	<div id="ride_output">
	</div>
</div>

<script id="ride_template" type="x-template">
	<h3>{{ user.trainsettings.name }}</h3>

	<a-scene>
		<a-assets>
			<a-asset-item
				v-for="monster in configurable.monsters"
				id="monster_{{ $key }}_model"
				src="{{ monster.model }}"
			></a-asset-item>
			<img
				v-for="monster in configurable.monsters"
				id="monster_{{ $key }}_texture"
				src="{{ monster.texture }}"
			></img>
			<img id="forest" src="assets/textures/forest/walls.jpg"></img>
			<img id="castle" src="assets/textures/castle/walls.jpg"></img>
			<img id="floor" src="assets/textures/floor-tiles.jpg"></img>
		</a-assets>

		<a-entity position="16 4 5">
			<a-camera collider>
				<a-entity
					v-if="$root.system.sound.chain"
					sound="src: assets/sounds/chain.mp3; autoplay: true; loop: true; volume: 0.4;"
				></a-entity>
			</a-camera>
		</a-entity>

		<a-sky color="{{system.sky.colour}}"></a-sky>

		<gt-room
			v-for="room in user.rooms"
			v-bind:index="$index"
			v-bind:room="room"
		></gt-room>

		<a-entity>
		<!--<a-box position="0 2 0" color="green"></a-box>-->




	</a-entity>
	</a-scene>
</script>

<script id="room_template" type="x-template">




	 <a-entity
		id="room_{{ index }}"
		position="0 0 0" <!--{{ index * -1 * $root.system.room.height }}" -->
		rotation: "0 90 0"
	>

		<a-entity id="floor">
			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="8 0 2"
				material="src:#floor">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="16 0 2"
				material="src:#floor">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="24 0 2"
				material="src:#floor">
			</a-entity>
			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="32 0 2"
				material="src:#floor">
			</a-entity>
			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="40 0 2"
				material="src:#floor">
			</a-entity>


			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="8 0 -6"
				material="src:#floor">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="16 0 -6"
				material="src:#floor">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="24 0 -6"
				material="src:#floor">
			</a-entity>
			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="32 0 -6"
				material="src:#floor">
			</a-entity>
			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="40 0 -6"
				material="src:#floor">
			</a-entity>


			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="8 0 -14"
				material="src:#floor">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="16 0 -14"
				material="src:#floor">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="24 0 -14"
				material="src:#floor">
			</a-entity>
			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="32 0 -14"
				material="src:#floor">
			</a-entity>
			<a-entity obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"
				position="40 0 -14"
				material="src:#floor">
			</a-entity>
		</a-entity>

		<a-entity id="inner-wall-1">
			<a-entity obj-model="obj: url(assets/model-buildkit/walls/wall_default_8x4.obj);"
				position="16 0 -6"
			 	rotation="0 90 0"
			 	material="src:#castle">
			</a-entity>

		</a-entity>

		<a-entity id="west-wall">
			<a-entity obj-model="obj: url(assets/model-buildkit/walls/wall_default_8x4.obj);"
				position="0 0 0"
				material="src:#castle"
				color="red">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/walls/corner_default_1x1-1.obj);"
				position="0 0 -16"
				material="src:#castle"
				color="red">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/walls/corner_default_1x1-1.obj);"
				position="2 0 2"
				rotation="0 90 0"
				material="src:#castle"
				color="red">
			</a-entity>
		</a-entity>

		<a-entity id="south-wall">
			<a-entity obj-model="obj: url(assets/model-buildkit/walls/wall_default_4x4.obj);"
				position="6 0 -18"
			 	rotation="0 90 0"
			 	material="src:#castle">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/walls/wall_door-frame.obj);"
				position="24 0 -18"
			 	rotation="0 90 0"
			 	material="src:#castle">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/walls/wall_default_4x4.obj);"
				position="28 0 -18"
			 	rotation="0 90 0"
			 	material="src:#castle">
			</a-entity>
		</a-entity>

		<a-entity id="east-wall" rotation="0 180 0" position="34 0 -16">
			<a-entity obj-model="obj: url(assets/model-buildkit/walls/wall_default_8x4.obj);"
				position="0 0 0"
				material="src:#castle"
				color="red">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/walls/corner_default_1x1-1.obj);"
				position="0 0 -16"
				material="src:#castle"
				color="red">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/walls/corner_default_1x1-1.obj);"
				position="2 0 2"
				rotation="0 90 0"
				material="src:#castle"
				color="red">
			</a-entity>
		</a-entity>

		<a-entity id="north-wall" position="0 0 2" rotation="0 0 0">
			<a-entity obj-model="obj: url(assets/model-buildkit/walls/wall_default_4x4.obj);"
				position="6 0 0"
			 	rotation="0 270 0"
			 	material="src:#castle">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/walls/wall_door-frame.obj);"
				position="10 0 0"
			 	rotation="0 270 0"
			 	material="src:#castle">
			</a-entity>

			<a-entity obj-model="obj: url(assets/model-buildkit/walls/wall_default_4x4.obj);"
				position="28 0 0"
			 	rotation="0 270 0"
			 	material="src:#castle">
			</a-entity>
		</a-entity>

		<gt-scare
			v-for="scare in room.scares"
			v-bind:index="$index"
			v-bind:monster="scare.monster"
			v-bind:sound="scare.sound"
			v-bind:animation="scare.animation"
			v-bind:pos="scare.position"
		></gt-scare>

		<!--<gt-light v-bind:type="room.light"></gt-light>

		<a-entity
		 obj-model="obj: url(assets/theme-room-floor.obj);"
			material="src:#floor-texture"
		>

		<a-entity
		 obj-model="obj: url(assets/theme-room-walls.obj);"
		 material="src: #{{ room.theme }}"
		 side="double">
		 </a-entity>-->



	</a-entity>
</script>


<script id="scare_template" type="x-template">
	<a-entity
		v-if="monster !== 'none'"
		id="monster_{{ $parent.room.number }}_{{ animation }}" position="{{ pos }}"
	>
		<a-obj-model
			rotation="0 0 0"
			scale="0.9 0.9 0.9"
			src="#monster_{{ monster }}_model"
			material="color: {{ $root.configurable.monsters[monster].colour }}; src: #monster_{{ monster }}_texture"
			collidable
			visible="false"
			sound="src: {{ $root.configurable.sounds[sound].mp3 }}; on:hit;"
		>
			<gt-animation v-bind:type="animation"></gt-animation>
		</a-obj-model>
	</a-entity>
</script>

<script id="animation_template" type="x-template">
	<a-animation
		v-if="type === 'popup'"
		begin="hit"
		attribute="rotation"
		from="-90 0 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>
	<a-animation
		v-if="type === 'popup'"
		begin="hit"
		attribute="position"
		from="0 {{ $root.system.monster.height * -1 }} 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>

	<a-animation
		v-if="type === 'dropdown'"
		begin="hit"
		attribute="position"
		from="0 5 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>
	<a-animation
		v-if="type === 'dropdown'"
		begin="hit"
		attribute="rotation"
		from="0 0 30"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>

	<a-animation
		v-if="type === 'fromleft'"
		begin="hit"
		attribute="rotation"
		from="0 90 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>
	<a-animation
		v-if="type === 'fromleft'"
		begin="hit"
		attribute="position"
		from="{{ $root.system.monster.width * -8 }} 0 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>

	<a-animation
		v-if="type === 'fromright'"
		attribute="rotation"
		begin="hit"
		from="0 -90 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>
	<a-animation
		v-if="type === 'fromright'"
		attribute="position"
		begin="hit"
		from="{{ $root.system.monster.width * 1 }} 0 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>

	<a-animation
		v-if="type === 'slideleft'"
		begin="hit"
		attribute="position"
		from="0 0 0"
		to="3 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>


</script>

<script id="light_template" type="x-template">
	<a-light
		v-if="type !== 'dark'"
		type="point"
		intensity="0.75"
		distance="15"
		decay="2"
		position="0 3 0"
	>
		<a-animation
			v-if="type === 'flickering'"
			attribute="intensity"
			dur="300"
			fill="forwards"
			from="1"
			to="0"
			direction="alternate"
			repeat="indefinite"></a-animation>
		<a-animation
			v-if="type === 'glowing'"
			attribute="intensity"
			dur="1000"
			fill="forwards"
			from="1"
			to="0"
			direction="alternate"
			easing="ease"
			repeat="indefinite"></a-animation>
	</a-light>
</script>
