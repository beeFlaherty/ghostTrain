<h2>Virtual experience</h2>

<div id="virtual_experience">
	<div id="ride_output">
	</div>
</div>

<script id="ride_template" type="x-template">
	<h3>{{ user.trainsettings.name }}</h3>

	<a-scene>
		<a-assets>
			<a-asset-item
				v-for="monster in configurable.monsters"
				id="monster_{{ $key }}_model"
				src="{{ monster.model }}"
			></a-asset-item>
			<img
				v-for="monster in configurable.monsters"
				id="monster_{{ $key }}_texture"
				src="{{ monster.texture }}"
			></img>
		</a-assets>

		<a-entity position="0 1.5 7">
			<a-camera collider></a-camera>
		</a-entity>

		<a-sky color="{{system.sky.colour}}"></a-sky>

		<gt-room
			v-for="room in user.rooms"
			v-bind:index="$index"
			v-bind:room="room"
		></gt-room>
	</a-scene>
</script>

<script id="room_template" type="x-template">
	<a-entity
		id="room_{{ index }}"
		position="0 0 {{ index * -1 * $root.system.room.height }}"
	>
		<gt-light v-bind:type="room.light"></gt-light>

		<a-plane
			rotation="-90 0 0"
			position="0 0 0"
			width="{{ $root.system.room.width }}"
			height="{{ $root.system.room.height }}"
			color="{{ $root.configurable.themes[room.theme].colour }}"
		></a-plane>

		<gt-scare
			v-for="scare in room.scares"
			v-bind:index="$index"
			v-bind:monster="scare.monster"
			v-bind:sound="scare.sound"
			v-bind:animation="scare.animation"
		></gt-scare>
	</a-entity>
</script>


<script id="scare_template" type="x-template">
	<a-entity
		v-if="monster !== 'none'"
		position="0 {{ $root.system.monster.height / 2 }} {{ getPosition(index) }}"
	>
		<a-obj-model
			rotation="0 0 0"
			scale="0.3 0.3 0.3"
			opacity="0"
			src="#monster_{{ monster }}_model"
			material="color: {{ $root.configurable.monsters[monster].colour }}; src: #monster_{{ monster }}_texture"
			collidable
		>
			<gt-animation v-bind:type="animation"></gt-animation>
		</a-obj-model>
	</a-entity>
</script>

<script id="animation_template" type="x-template">
	<a-animation
		begin="hit"
		attribute="opacity"
		from="0"
		to="1"
		dur="1"
		fill="both"
		repeat="0"
	></a-animation>

	<a-animation
		v-if="type === 'popup'"
		begin="hit"
		attribute="rotation"
		from="-90 0 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>
	<a-animation
		v-if="type === 'popup'"
		begin="hit"
		attribute="position"
		from="0 {{ $root.system.monster.height * -1 }} 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>

	<a-animation
		v-if="type === 'dropdown'"
		begin="hit"
		attribute="position"
		from="0 5 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>
	<a-animation
		v-if="type === 'dropdown'"
		begin="hit"
		attribute="rotation"
		from="0 0 30"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>

	<a-animation
		v-if="type === 'fromleft'"
		begin="hit"
		attribute="rotation"
		from="0 90 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>
	<a-animation
		v-if="type === 'fromleft'"
		begin="hit"
		attribute="position"
		from="{{ $root.system.monster.width * -1 }} 0 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>

	<a-animation
		v-if="type === 'fromright'"
		attribute="rotation"
		begin="hit"
		from="0 -90 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>
	<a-animation
		v-if="type === 'fromright'"
		attribute="position"
		begin="hit"
		from="{{ $root.system.monster.width * 1 }} 0 0"
		to="0 0 0"
		dur="{{ $root.system.animation.duration }}"
		fill="both"
		easing="ease-out-bounce"
		repeat="{{ $root.system.animation.repeat }}"
	></a-animation>
</script>

<script id="light_template" type="x-template">
	<a-light
		v-if="type !== 'dark'"
		type="point"
		intensity="0.75"
		distance="15"
		decay="2"
		position="0 3 0"
	>
		<a-animation
			v-if="type === 'flickering'"
			attribute="intensity"
			dur="300"
			fill="forwards"
			from="1"
			to="0"
			direction="alternate"
			repeat="indefinite"></a-animation>
		<a-animation
			v-if="type === 'glowing'"
			attribute="intensity"
			dur="1000"
			fill="forwards"
			from="1"
			to="0"
			direction="alternate"
			easing="ease"
			repeat="indefinite"></a-animation>
	</a-light>
</script>
