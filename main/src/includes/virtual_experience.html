<script id="ride_template" type="x-template">
	<a-scene stats fog="type: exponential; color: {{ system.sky.colour }}; density: 0.02;">
		<a-assets>
			<a-asset-item v-for="monster in configurable.monsters" id="monster_{{ $key }}_model" src="{{ monster.model }}"></a-asset-item>
			<img v-for="monster in configurable.monsters" id="monster_{{ $key }}_texture" src="{{ monster.texture }}"></img>

			<a-asset-item id="floor-material" src="assets/model-buildkit/floors/floor-default-4x4.mtl"></a-asset-item>

			<img id="castle" src="assets/textures/castle/walls.jpg"></img>
			<img id="forest" src="assets/textures/forest/walls.jpg"></img>
			<img id="dark" src="assets/textures/dark/walls.jpg"></img>
			<img id="generic-ceiling" src="assets/textures/ceiling.jpg"></img>
			<img id="floor" src="assets/textures/floor_18.png"></img>

			<!-- walls -->
			<a-mixin id="wall-lg" obj-model="obj: url(assets/model-buildkit/walls/wall_default_8x4.obj);"></a-mixin>
			<a-mixin id="wall-md" obj-model="obj: url(assets/model-buildkit/walls/wall_default_4x4.obj);"></a-mixin>
			<a-mixin id="wall-sm" obj-model="obj: url(assets/model-buildkit/walls/wall_default_2x4.obj);"></a-mixin>

			<!-- corners -->
			<a-mixin id="corner-sm" obj-model="obj: url(assets/model-buildkit/walls/corner_default_1x1-1.obj);"></a-mixin>

			<!-- doorframe -->
			<a-mixin id="doorframe" obj-model="obj: url(assets/model-buildkit/walls/wall_door-frame.obj);"></a-mixin>

			<!-- door -->
			<a-mixin id="door" obj-model="obj: url(assets/model-buildkit/interactive/door-1.obj);"></a-mixin>

			<!-- floor -->
			<a-mixin id="floor" obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"></a-mixin>
			<a-mixin id="generic-floor" material="src:#floor; roughness:1;"></a-mixin>
			<a-mixin id="ceiling" obj-model="obj: url(assets/model-buildkit/floors/floor-default-4x4.obj);"></a-mixin>
			<a-mixin id="generic-ceiling" material="src:#generic-ceiling; roughness:1;"></a-mixin>
			<a-mixin id="castle-wall" material="src:#castle; roughness:1;"></a-mixin>
			<a-mixin id="forest-wall" material="src:#forest; roughness:1;"></a-mixin>
			<a-mixin id="dark-wall" material="src:#dark; roughness:1;"></a-mixin>
			<a-mixin id="generic-door" mtl="assets/assets/model-buildkit/interactive/door-1.mtl"></a-mixin>
		</a-assets>

		<a-entity id="rotation-helper" position="0 0 0" rotation="0 0 0">
			<!--	<a-box position="0 0 0" color="blue"></a-box> -->
		</a-entity>

		<a-entity position="16 4 15" kart=" {{ system.track.speed }}"><!-- Need this space before the {{ for some reason -->
			<a-entity obj-model="obj: url(assets/model-buildkit/props/kart.obj); mtl: url(assets/model-buildkit/props/kart.mtl)" position="0 -3.5 0" scale="2 2 2" rotation="0 0 0" roughness="1"></a-entity>
			<a-entity rotation="0 180 0">
				<a-camera collider position="-0.75 -0.5 0.3" rotation="0 0 0" wasd-controls-enabled="false"></a-camera>
				<a-entity
					v-if="$root.system.sound.chain"
					sound="src: assets/sounds/chain.mp3; autoplay: true; loop: true; volume: 0.3;"
				></a-entity>
				<a-entity
					v-if="$root.user.trainsettings.music !== 'none'"
					sound="src: {{ $root.configurable.music[$root.user.trainsettings.music].mp3 }}; autoplay: true; loop: true; volume: 0.6;"
				></a-entity>
			</a-entity>
		</a-entity>

		<!-- <a-camera collider  position="10 4 -18" rotation="0 0 0" wasd-controls-enabled="true"></a-camera> -->

		<a-entity v-for="point in system.track.points" track position="{{ point }}" order="{{ $index }}">
			<a-sphere v-if="system.track.showPoints" position="0 -3.75 0" radius="0.25" width="1" height="1" depth="1" color="#ffffff"></a-box>
		</a-entity>

		<a-sky color="{{ system.sky.colour }}"></a-sky>

		<gt-room v-bind:room="user.rooms"></gt-room>
	</a-scene>
</script>

<script id="room_template" type="x-template">
	<a-entity id="room_0" position="0 0 0" rotation: "0 90 0">

		<gt-light v-for="light in room[0].lights" v-bind:color="light.color" v-bind:style="light.style" v-bind:position="light.position"></gt-light>


		<a-entity id="floor">
			<a-entity mixin="floor generic-floor" position="8 0 2"></a-entity>
			<a-entity mixin="floor generic-floor" position="16 0 2"></a-entity>
			<a-entity mixin="floor generic-floor" position="24 0 2"></a-entity>
			<a-entity mixin="floor generic-floor" position="32 0 2"></a-entity>
			<a-entity mixin="floor generic-floor" position="40 0 2"></a-entity>
			<a-entity mixin="floor generic-floor" position="8 0 -6" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="16 0 -6" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="24 0 -6" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="32 0 -6" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="40 0 -6" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="8 0 -14" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="16 0 -14" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="24 0 -14" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="32 0 -14" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="40 0 -14" roughness="1"></a-entity>
		</a-entity>

		<a-entity id="ceiling" position="36 8 0" rotation="0 0 180">
			<a-entity mixin="ceiling generic-ceiling" position="8 0 2"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="16 0 2"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="24 0 2"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="32 0 2"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="40 0 2"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="8 0 -6"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="16 0 -6"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="24 0 -6"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="32 0 -6"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="40 0 -6"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="8 0 -14"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="16 0 -14"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="24 0 -14"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="32 0 -14"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="40 0 -14"></a-entity>
		</a-entity>

		<a-entity id="inner-wall-1">
			<a-entity mixin="wall-lg {{ room[0].theme }}-wall" position="16 0 -6" rotation="0 90 0"></a-entity>
		</a-entity>

		<a-entity id="west-wall">
			<a-entity mixin="wall-lg {{ room[0].theme }}-wall" position="0 0 0"></a-entity>
			<a-entity mixin="corner-sm {{ room[0].theme }}-wall" position="0 0 -16"></a-entity>
			<a-entity mixin="corner-sm {{ room[0].theme }}-wall" position="2 0 2" rotation="0 90 0"></a-entity>
		</a-entity>

		<a-entity id="south-wall">
			<a-entity mixin="wall-md {{ room[0].theme }}-wall" position="6 0 -18" rotation="0 90 0"></a-entity>
			<a-entity mixin="doorframe {{ room[0].theme }}-wall" position="24 0 -18" rotation="0 90 0"></a-entity>
			<a-entity mixin="wall-md {{ room[0].theme }}-wall" position="28 0 -18" rotation="0 90 0"></a-entity>
		</a-entity>

		<a-entity id="east-wall" rotation="0 0 0" position="34 0 0">
			<a-entity mixin="wall-lg {{ room[0].theme }}-wall" position="0 0 0"></a-entity>
			<a-entity mixin="corner-sm {{ room[0].theme }}-wall" position="-2 0 -18" rotation="0 -90 0"></a-entity>
			<a-entity mixin="corner-sm {{ room[0].theme }}-wall" position="0 0 0" rotation="0 -180 0"></a-entity>
		</a-entity>

		<a-entity id="north-wall" position="0 0 2" rotation="0 0 0">

			<a-entity mixin="wall-md {{ room[0].theme }}-wall" position="6 0 0" rotation="0 270 0"></a-entity>
			<a-entity mixin="doorframe {{ room[0].theme }}-wall" position="10 0 0" rotation="0 270 0"></a-entity>
			<a-entity mixin="wall-md {{ room[0].theme }}-wall" position="28 0 0" rotation="0 270 0"></a-entity>
		</a-entity>

		<gt-scare v-for="scare in room[0].scares" v-bind:index="$index" v-bind:monster="scare.monster" v-bind:sound="scare.sound" v-bind:animation="scare.animation" v-bind:pos="scare.position"></gt-scare>
	</a-entity>


	<a-entity id="room_1" position="0 0 -20.5" rotation: "0 90 0">
		<a-light v-if="type !== 'dark'" type="point" intensity="5" distance="25" decay="2" position="0.5 3 -2" color="{{ lightcolor }}">
			<a-animation v-if="type === 'flickering'" attribute="intensity" dur="1300" fill="forwards" from="1" to="0" direction="alternate" repeat="indefinite"></a-animation>
			<a-animation v-if="type === 'glowing'" attribute="intensity" dur="1000" fill="forwards" from="1" to="0" direction="alternate" easing="ease" repeat="indefinite"></a-animation>
		</a-light>

		<a-light v-if="type !== 'dark'" type="point" intensity="1" distance="25" decay="2" position="27.5 3 -2" color="green">
			<a-animation v-if="type === 'flickering'" attribute="intensity" dur="1300" fill="forwards" from="1" to="0" direction="alternate" repeat="indefinite"></a-animation>
			<a-animation v-if="type === 'glowing'" attribute="intensity" dur="1000" fill="forwards" from="1" to="0" direction="alternate" easing="ease" repeat="indefinite"></a-animation>
		</a-light>

		<a-light v-if="type !== 'dark'" type="point" intensity="3" distance="25" decay="2" position="0.5 3 -16" color="red">
			<a-animation v-if="type === 'flickering'" attribute="intensity" dur="1300" fill="forwards" from="1" to="0" direction="alternate" repeat="indefinite"></a-animation>
			<a-animation v-if="type === 'glowing'" attribute="intensity" dur="1000" fill="forwards" from="1" to="0" direction="alternate" easing="ease" repeat="indefinite"></a-animation>
		</a-light>

		<a-light v-if="type !== 'dark'" type="point" intensity="1" distance="25" decay="2" position="27.5 3 -16" color="white">
			<a-animation v-if="type === 'flickering'" attribute="intensity" dur="1300" fill="forwards" from="1" to="0" direction="alternate" repeat="indefinite"></a-animation>
			<a-animation v-if="type === 'glowing'" attribute="intensity" dur="1000" fill="forwards" from="1" to="0" direction="alternate" easing="ease" repeat="indefinite"></a-animation>
		</a-light>

		<a-entity id="floor">
			<a-entity mixin="floor generic-floor" position="8 0 2" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="16 0 2" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="24 0 2" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="32 0 2" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="40 0 2" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="8 0 -6" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="16 0 -6" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="24 0 -6" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="32 0 -6" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="40 0 -6" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="8 0 -14" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="16 0 -14" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="24 0 -14" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="32 0 -14" roughness="1"></a-entity>
			<a-entity mixin="floor generic-floor" position="40 0 -14" roughness="1"></a-entity>
		</a-entity>

		<a-entity id="ceiling" position="36 8 0" rotation="0 0 180">
			<a-entity mixin="floor" position="8 0 2"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="16 0 2"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="24 0 2"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="32 0 2"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="40 0 2"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="8 0 -6"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="16 0 -6"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="24 0 -6"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="32 0 -6"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="40 0 -6"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="8 0 -14"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="16 0 -14"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="24 0 -14"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="32 0 -14"></a-entity>
			<a-entity mixin="ceiling generic-ceiling" position="40 0 -14"></a-entity>
		</a-entity>

		<a-entity id="west-wall">
			<a-entity mixin="wall-sm {{ room[1].theme }}-wall" position="0 0 -2"></a-entity>
			<a-entity mixin="corner-sm {{ room[1].theme }}-wall" position="2 0 2" rotation="0 90 0"></a-entity>
			<a-entity mixin="corner-sm {{ room[1].theme }}-wall" position="0 0 -4"></a-entity>
		</a-entity>

		<a-entity id="south-wall">
			<a-entity mixin="wall-lg {{ room[1].theme }}-wall" position="16 0 -6" rotation="0 90 0"></a-entity>
			<a-entity mixin="wall-lg {{ room[1].theme }}-wall" position="24 0 -6" rotation="0 90 0"></a-entity>
			<a-entity mixin="wall-lg {{ room[1].theme }}-wall" position="32 0 -6" rotation="0 90 0"></a-entity>
			<a-entity mixin="wall-sm {{ room[1].theme }}-wall" position="34 0 -6" rotation="0 90 0"></a-entity>
		</a-entity>

		<a-entity id="east-wall" rotation="0 0 0" position="34 0 0">
			<a-entity mixin="doorframe {{ room[1].theme }}-wall" position="0 0 5"></a-entity>
		</a-entity>

		<a-entity id="north-wall" position="0 0 2" rotation="0 0 0">
			<a-entity mixin="wall-md {{ room[1].theme }}-wall" position="6 0 0" rotation="0 270 0"></a-entity>
			<a-entity mixin="doorframe {{ room[1].theme }}-wall" position="10 0 0" rotation="0 270 0"></a-entity>
			<a-entity mixin="wall-lg {{ room[1].theme }}-wall" position="24 0 0" rotation="0 270 0"></a-entity>
		</a-entity>

		<gt-scare v-for="scare in room[1].scares" v-bind:index="$index" v-bind:monster="scare.monster" v-bind:sound="scare.sound" v-bind:animation="scare.animation" v-bind:pos="scare.position" v-bind:rotation="scare.rotation"></gt-scare>
	</a-entity>

</script>

<script id="light_template" type="x-template">
		<a-light v-if="style !== 'dark'" type="point" intensity="5" distance="25" decay="2" position="{{ position }}" color="{{ color }}" id="test-search">
			<a-animation v-if="style === 'flickering'" attribute="intensity" dur="100" fill="forwards" from="1" to="0" direction="alternate" repeat="indefinite"></a-animation>
			<a-animation v-if="style === 'glowing'" attribute="intensity" dur="1000" fill="forwards" from="1" to="0" direction="alternate" easing="ease" repeat="indefinite"></a-animation>
		</a-light>
		<a-light v-if="room[0].light !== 'dark'" type="point" intensity="3" distance="25" decay="2" position="0.5 3 -16" color="red">
			<a-animation v-if="room[0].light === 'flickering'" attribute="intensity" dur="100" fill="forwards" from="1" to="0" direction="alternate" repeat="indefinite"></a-animation>
			<a-animation v-if="room[0].light === 'glowing'" attribute="intensity" dur="1000" fill="forwards" from="1" to="0" direction="alternate" easing="ease" repeat="indefinite"></a-animation>
		</a-light>
</script>


<script id="scare_template" type="x-template">
	<a-entity v-if="monster !== 'none'" id="monster_{{ animation }}" position="{{ pos }}" rotation="{{ rotation }}">
		<a-obj-model rotation="0 0 0" scale="0.9 0.9 0.9" src="#monster_{{ monster }}_model" material="src: #monster_{{ monster }}_texture; shader: standard;" collidable="{{ $root.system.monster.triggerDistance }}" visible="false" sound="src: {{ $root.configurable.sounds[sound].mp3 }}; on:hit;">
			<gt-animation v-bind:type="animation"></gt-animation>
		</a-obj-model>
	</a-entity>
</script>

<script id="animation_template" type="x-template">
	<a-animation v-if="type === 'popup'" begin="hit" attribute="rotation" from="-90 0 0" to="0 0 0" dur="{{ $root.system.animation.duration }}" fill="both" easing="ease-out-bounce" repeat="{{ $root.system.animation.repeat }}"></a-animation>
	<a-animation v-if="type === 'popup'" begin="hit" attribute="position" from="0 {{ $root.system.monster.height * -1 }} 0" to="0 0 0" dur="{{ $root.system.animation.duration }}" fill="both" easing="ease-out-bounce" repeat="{{ $root.system.animation.repeat }}"></a-animation>

	<a-animation v-if="type === 'dropdown'" begin="hit" attribute="position" from="0 5 0" to="0 0 0" dur="{{ $root.system.animation.duration }}" fill="both" easing="ease-out-bounce" repeat="{{ $root.system.animation.repeat }}"></a-animation>
	<a-animation v-if="type === 'dropdown'" begin="hit" attribute="rotation" from="0 0 30" to="0 0 0" dur="{{ $root.system.animation.duration }}" fill="both" easing="ease-out-bounce" repeat="{{ $root.system.animation.repeat }}"></a-animation>

	<a-animation v-if="type === 'fromleft'" begin="hit" attribute="rotation" from="0 90 0" to="0 0 0" dur="{{ $root.system.animation.duration }}" fill="both" easing="ease-out-bounce" repeat="{{ $root.system.animation.repeat }}"></a-animation>
	<a-animation v-if="type === 'fromleft'" begin="hit" attribute="position" from="{{ $root.system.monster.width * -8 }} 0 0" to="0 0 0" dur="{{ $root.system.animation.duration }}" fill="both" easing="ease-out-bounce" repeat="{{ $root.system.animation.repeat }}"></a-animation>

	<a-animation v-if="type === 'fromright'" begin="hit" attribute="rotation" from="0 -90 0" to="0 0 0" dur="{{ $root.system.animation.duration }}" fill="both" easing="ease-out-bounce" repeat="{{ $root.system.animation.repeat }}"></a-animation>
	<a-animation v-if="type === 'fromright'" begin="hit" attribute="position" from="{{ $root.system.monster.width * 1 }} 0 0" to="0 0 0" dur="{{ $root.system.animation.duration }}" fill="both" easing="ease-out-bounce" repeat="{{ $root.system.animation.repeat }}"></a-animation>

	<a-animation v-if="type === 'slideleft'" begin="hit" attribute="position" from="0 0 0" to="3 0 0" dur="{{ $root.system.animation.duration }}" fill="both" easing="ease-out-bounce" repeat="{{ $root.system.animation.repeat }}"></a-animation>
</script>

<script id="light_template" type="x-template">

</script>
